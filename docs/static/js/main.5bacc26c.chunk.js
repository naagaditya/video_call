(this.webpackJsonpvideo_call=this.webpackJsonpvideo_call||[]).push([[0],{26:function(e,t,n){},28:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(7),c=n.n(a),r=n(20),o=n.n(r),i=(n(26),n(6)),s=n.n(i),d=n(10),u=n(37),p=(n(28),n(29),n(21)),f=n(9),l=n(14);l.a.initializeApp({apiKey:"AIzaSyDdzhAHhMQeAo4egpTbj3K-JiuV_InAFkU",authDomain:"fir-rtc-8e4b2.firebaseapp.com",databaseURL:"https://fir-rtc-8e4b2.firebaseio.com",projectId:"fir-rtc-8e4b2",storageBucket:"fir-rtc-8e4b2.appspot.com",messagingSenderId:"159303557727",appId:"1:159303557727:web:2ae59edac452b77736b1ea",measurementId:"G-FWJYK5VF1B"});var b=l.a.firestore(),w=function(e){var t=document.createElement("video");t.style="width: 100%;max-width:500px;",t.playsInline=!0,t.autoplay=!0,t.muted=!0,t.srcObject=e,document.getElementById("room").appendChild(t)},h={iceServers:[{urls:["stun:turn2.l.google.com"]}]},x=function(e,t,n){var a=new RTCPeerConnection(h);e&&e.getTracks().forEach((function(t){console.log("adding track in connection"),a.addTrack(t,e)}));var c=new MediaStream;return a.createDataChannel("sendChannel").onopen=function(e){console.log("open!!!!",t),window.connectedCandidates.push("".concat(t)),w(c)},a.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){c.addTrack(e)}))},a},m=n(11);function v(){var e;window.connectedCandidates=[],function(){var t=Object(d.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:e=t.sent,document.querySelector("#localVideo").srcObject=e;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()();var t=window.location.search.split("=")[1],n=b.collection("rooms").doc("".concat(t)),a={},c=0,r=function(){var t=Object(d.a)(s.a.mark((function t(r){var o,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=x(e,r,window.connectedCandidates),a[r]=o,o.onicecandidate=function(){var e=Object(d.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.candidate){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(r,".").concat(c,".candidate_for_").concat(c),l.a.firestore.FieldValue.arrayUnion(t.candidate.toJSON())));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.onicegatheringstatechange=function(){var e=Object(d.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("complete"!==t.target.iceGatheringState||window.connectedCandidates.includes(r)){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(r,".").concat(c,".iceGatheringComplete_for_").concat(c),!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.onicecandidateerror=function(e){console.log(e.errorText)},t.next=7,o.createOffer();case 7:return i=t.sent,t.next=10,n.update(Object(f.a)({},"".concat(r,".").concat(c),{offer:{type:i.type,sdp:i.sdp}}));case 10:o.setLocalDescription(i),console.log("step 1: offer created and updated");case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),o=function(){var e=Object(d.a)(s.a.mark((function e(t,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(c,".").concat(a,".candidate_for_").concat(c),l.a.firestore.FieldValue.arrayUnion(t.toJSON())));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i=function(){var e=Object(d.a)(s.a.mark((function e(t,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("complete"!==t||window.connectedCandidates.includes(a)){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(c,".").concat(a,".iceGatheringComplete_for_").concat(c),!0));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return function(){var t=Object(d.a)(s.a.mark((function t(){var u,l,b;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.get();case 2:return u=t.sent,l=u.exists&&u.data(),(b=parseInt(Object.keys(l).length))&&(c=parseInt(Object.keys(l)[b-1])+1,Object.keys(u.data()).forEach(r)),t.next=8,n.update(Object(f.a)({},c,{}));case 8:n.onSnapshot(function(){var t=Object(d.a)(s.a.mark((function t(r){var d,u,l,b,w,h,m,v,j,k,g,y,O,_,C,I,S,D;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:d=r.data()[c],u=s.a.mark((function t(){var r,u,p,w,h,m,v,j,k,g;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=b[l],!a[r]||!window.connectedCandidates.includes(r)){t.next=3;break}return t.abrupt("return",{v:void 0});case 3:if(!(u=d[r])||!u.offer||a[r]){t.next=21;break}return p=u.offer,w=x(e,r,window.connectedCandidates),a[r]=w,w.onicecandidate=function(e){o(e.candidate,r)},w.onicegatheringstatechange=function(e){i(e.target.iceGatheringState,r)},h=new RTCSessionDescription(p),t.next=13,w.setRemoteDescription(h);case 13:return t.next=15,w.createAnswer();case 15:return m=t.sent,t.next=18,w.setLocalDescription(m);case 18:return t.next=20,n.update(Object(f.a)({},"".concat(c,".").concat(r),{answer:{type:m.type,sdp:m.sdp}}));case 20:console.log("step 2: set offer created answer and updated answer");case 21:if(!(u&&u["iceGatheringComplete_for_".concat(c)]&&u["iceGatheringComplete_for_".concat(r)])){t.next=24;break}return t.next=24,n.update((v={},Object(f.a)(v,"".concat(c,".").concat(r,".try_canditate"),0),Object(f.a)(v,"".concat(c,".").concat(r,".iceGatheringComplete_for_").concat(c),!1),Object(f.a)(v,"".concat(c,".").concat(r,".iceGatheringComplete_for_").concat(r),!1),v));case 24:if(!(u&&u.try_canditate>=0)||u.try_canditate_start||window.connectedCandidates.includes(r)){t.next=34;break}if(j=u.try_canditate,!(k=u["candidate_for_".concat(c)][j])){t.next=32;break}return g=new RTCIceCandidate(k),t.next=31,a[r].addIceCandidate(g);case 31:console.log("tried ",j);case 32:return t.next=34,n.update(Object(f.a)({},"".concat(c,".").concat(r,".try_canditate_start"),!0));case 34:case"end":return t.stop()}}),t)})),l=0,b=Object.keys(d);case 3:if(!(l<b.length)){t.next=11;break}return t.delegateYield(u(),"t0",5);case 5:if("object"!==typeof(w=t.t0)){t.next=8;break}return t.abrupt("return",w.v);case 8:l++,t.next=3;break;case 11:h=0,m=Object.keys(a);case 12:if(!(h<m.length)){t.next=50;break}if(v=m[h],j=a[v],k=r.data()[v][c],j.currentRemoteDescription||!k||!k.answer){t.next=21;break}return g=new RTCSessionDescription(k.answer),t.next=20,j.setRemoteDescription(g);case 20:console.log("Step 3: Got the answer and set the answer to remote");case 21:if(!k||!k.try_canditate_start||window.connectedCandidates.includes(v)){t.next=47;break}y=k.try_canditate,O=k["candidate_for_".concat(v)]||[],_=Object(p.a)(O),t.prev=25,_.s();case 27:if((C=_.n()).done){t.next=36;break}if(I=C.value,window.connectedCandidates.includes(v)||!I){t.next=34;break}return S=new RTCIceCandidate(I),t.next=33,j.addIceCandidate(S);case 33:console.log("tried ",y);case 34:t.next=27;break;case 36:t.next=41;break;case 38:t.prev=38,t.t1=t.catch(25),_.e(t.t1);case 41:return t.prev=41,_.f(),t.finish(41);case 44:if(window.connectedCandidates.includes(v)||!(y<k["candidate_for_".concat(c)].length)){t.next=47;break}return t.next=47,n.update((D={},Object(f.a)(D,"".concat(v,".").concat(c,".try_canditate"),y+1),Object(f.a)(D,"".concat(v,".").concat(c,".try_canditate_start"),!1),D));case 47:h++,t.next=12;break;case 50:case"end":return t.stop()}}),t,null,[[25,38,41,44]])})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),Object(m.jsx)("div",{id:"room",children:Object(m.jsx)("video",{id:"localVideo",muted:!0,autoPlay:!0,playsInline:!0,style:{width:"100%",maxWidth:"500px"}})})}var j=function(){if(window.location.search.split("=")[1])return Object(m.jsx)(v,{});var e=function(){var e=Object(d.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.collection("rooms").add({});case 2:t=e.sent,window.location.href="".concat(window.location.href,"?roomId=").concat(t.id);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(u.a,{variant:"primary",onClick:e,children:"Create Room \u2192"})})};o.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(j,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.5bacc26c.chunk.js.map