{"version":3,"sources":["firebase.config.js","room/appendVideo.js","room/createNewConnection.js","room/Room.js","App.js","index.js"],"names":["firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","db","firestore","appendVideo","remoteStream","candidateId","remoteVideo","document","createElement","id","style","playsInline","autoplay","srcObject","getElementById","appendChild","configuration","createNewConnection","localStream","connection","RTCPeerConnection","getTracks","forEach","track","console","log","addTrack","MediaStream","sendChannel","createDataChannel","onopen","e","window","connectedCandidates","push","onclose","indexToRemove","indexOf","splice","remove","ontrack","event","streams","onconnectionstatechange","connectionState","myConnection","Room","a","navigator","mediaDevices","getUserMedia","video","audio","querySelector","openUserMedia","roomId","location","search","split","roomRef","collection","doc","RTCPeerConnections","myId","useEffect","addEventListener","preventDefault","returnValue","Object","keys","close","update","FieldValue","delete","createConnection","onicecandidate","candidate","arrayUnion","toJSON","onicegatheringstatechange","ev","target","iceGatheringState","includes","onicecandidateerror","errorText","createOffer","offer","type","sdp","setLocalDescription","updateCadidateArray","updateICEGathering","resolveWhenConnectionStateFailOrConnected","con","Promise","resolve","setInterval","get","roomSnapshot","candidates","exists","data","totalCandiates","parseInt","length","onSnapshot","snapshot","myDataConnections","remoteOffer","RTCSessionDescription","setRemoteDescription","createAnswer","answer","candidateIndex","iceCandidate","RTCIceCandidate","addIceCandidate","currentRemoteDescription","iceCandidates","result","init","muted","autoPlay","width","maxWidth","App","createRoom","add","href","className","Button","variant","onClick","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.783ef65a.chunk.js","sourcesContent":["import firebase from 'firebase'\nvar firebaseConfig = {\n    apiKey: \"AIzaSyDdzhAHhMQeAo4egpTbj3K-JiuV_InAFkU\",\n    authDomain: \"fir-rtc-8e4b2.firebaseapp.com\",\n    databaseURL: \"https://fir-rtc-8e4b2.firebaseio.com\",\n    projectId: \"fir-rtc-8e4b2\",\n    storageBucket: \"fir-rtc-8e4b2.appspot.com\",\n    messagingSenderId: \"159303557727\",\n    appId: \"1:159303557727:web:2ae59edac452b77736b1ea\",\n    measurementId: \"G-FWJYK5VF1B\"\n  };\n  firebase.initializeApp(firebaseConfig);\nconst db= firebase.firestore();\n\nexport default db;","const appendVideo = (remoteStream, candidateId) => {\n  const remoteVideo = document.createElement (\"video\");\n  remoteVideo.id = `video${candidateId}`;\n  remoteVideo.style = \"width: 100%;max-width:500px;\";\n  remoteVideo.playsInline = true;\n  remoteVideo.autoplay = true;\n  // remoteVideo.muted = true;\n  remoteVideo.srcObject = remoteStream;\n  document.getElementById('room').appendChild(remoteVideo);\n}\n\nexport default appendVideo;","import appendVideo from './appendVideo'\nconst configuration = {\"iceServers\":[{\"urls\":[\"stun:turn2.l.google.com\"]}]};\n\nconst createNewConnection = (localStream, candidateId) => {\n  const connection = new RTCPeerConnection(configuration);\n  localStream && localStream.getTracks().forEach(track => {\n    console.log('adding track in connection');\n    connection.addTrack(track, localStream);\n  });\n  const remoteStream = new MediaStream();\n  const sendChannel = connection.createDataChannel(\"sendChannel\");\n  sendChannel.onopen = e => {\n    console.log(\"open!!!!\", candidateId);\n    window.connectedCandidates.push(`${candidateId}`);\n    appendVideo(remoteStream, candidateId);\n  };\n  sendChannel.onclose = e => {\n    console.log(\"close!!!!\", candidateId);\n    const indexToRemove = window.connectedCandidates.indexOf(`${candidateId}`);\n    window.connectedCandidates.splice(indexToRemove, 1);\n    document.getElementById(`video${candidateId}`).remove();\n  }\n  connection.ontrack = event => {\n    event.streams[0].getTracks().forEach(track => {\n      remoteStream.addTrack(track);\n    });\n  }\n  connection.onconnectionstatechange = function(event) {\n    console.log(connection.connectionState)\n    switch(connection.connectionState) {\n      case \"connected\":\n        // The connection has become fully connected\n        break;\n      case \"disconnected\":\n      case \"failed\":\n        // One or more transports has terminated unexpectedly or in an error\n        break;\n      case \"closed\":\n        // The connection has been closed\n        break;\n      default:\n    }\n  }\n  window.myConnection = connection;\n  return connection;\n}\nexport default createNewConnection;","import React, { useEffect } from 'react';\nimport db from '../firebase.config';\nimport createNewConnection from './createNewConnection';\nimport firebase from 'firebase'\n\nexport default function Room() {\n  window.connectedCandidates = [];\n  let localStream;\n  const openUserMedia = async () => {\n    localStream = await navigator.mediaDevices.getUserMedia(\n      {video: true, audio: true});\n    document.querySelector('#localVideo').srcObject = localStream;\n  }\n  openUserMedia();\n  const roomId = window.location.search.split('=')[1];\n  const roomRef = db.collection('rooms').doc(`${roomId}`);\n  const RTCPeerConnections = {};\n  let myId = 0;\n  useEffect(() => {\n    window.addEventListener('beforeunload', async (e) => {\n      e.preventDefault();\n      e.returnValue = '';\n      for (const candidateId of Object.keys(RTCPeerConnections)) {\n        RTCPeerConnections[candidateId].close();\n        await roomRef.update({\n          [`${candidateId}.${myId}`]: firebase.firestore.FieldValue.delete()\n        });\n      }\n      await roomRef.update({\n        [myId]: firebase.firestore.FieldValue.delete()\n      });\n    });\n  },[]);\n  const createConnection = async (candidateId) => {\n    const connection = createNewConnection(localStream, candidateId);\n    RTCPeerConnections[candidateId] = connection;\n    connection.onicecandidate = async e =>  {\n      if (e.candidate) {\n        await roomRef.update({\n          [`${candidateId}.${myId}.candidate_for_${candidateId}`]: firebase.firestore.FieldValue.arrayUnion(e.candidate.toJSON())\n        });\n      }\n    }\n    connection.onicegatheringstatechange = async ev => {\n      if (ev.target.iceGatheringState === 'complete' && !window.connectedCandidates.includes(candidateId)) {\n        await roomRef.update({\n          [`${candidateId}.${myId}.iceGatheringComplete_for_${myId}`]: true\n        });\n      }\n    }\n    connection.onicecandidateerror = (e) => {console.log(e.errorText)}\n    const offer = await connection.createOffer();\n    await roomRef.update({\n      [`${candidateId}.${myId}`]: {\n        offer: {\n          type: offer.type,\n          sdp: offer.sdp\n        }\n      }\n    });\n    connection.setLocalDescription(offer);\n    console.log('step 1: offer created and updated');\n  }\n  const updateCadidateArray = async (candidate, candidateId) => {\n    if (candidate) {\n      await roomRef.update({\n        [`${myId}.${candidateId}.candidate_for_${candidateId}`]: firebase.firestore.FieldValue.arrayUnion(candidate.toJSON())\n      });\n    }\n  }\n  const updateICEGathering = async (iceGatheringState, candidateId) => {\n    if (iceGatheringState === 'complete' && !window.connectedCandidates.includes(candidateId)) {\n      await roomRef.update({\n        [`${myId}.${candidateId}.iceGatheringComplete_for_${myId}`]: true\n      });\n    }\n  }\n  const init = async () => {\n    const roomSnapshot = await roomRef.get();\n    const candidates = roomSnapshot.exists && roomSnapshot.data();\n    const totalCandiates = parseInt(Object.keys(candidates).length);\n    if (totalCandiates) {\n      myId = parseInt(Object.keys(candidates)[totalCandiates - 1]) + 1;\n      Object.keys(roomSnapshot.data()).forEach(createConnection);\n    }\n    await roomRef.update({\n      [myId]: {}\n    });\n    roomRef.onSnapshot(async snapshot => {\n      if (snapshot && snapshot.data()) {\n        // search offer, consume offer and create answer\n        const myDataConnections = snapshot.data()[myId];\n        for (const candidateId of Object.keys(myDataConnections)) {\n          if (!window.connectedCandidates.includes(candidateId)) {\n            const data = myDataConnections[candidateId];\n            if (data && data.offer && !RTCPeerConnections[candidateId]) {\n              const offer = data.offer;\n              const connection = createNewConnection(localStream, candidateId);\n              RTCPeerConnections[candidateId] = connection;\n              connection.onicecandidate = e =>  {\n                updateCadidateArray(e.candidate, candidateId);\n              }\n              connection.onicegatheringstatechange = ev => {\n                updateICEGathering(ev.target.iceGatheringState, candidateId);\n              }\n              const remoteOffer = new RTCSessionDescription(offer);\n              await connection.setRemoteDescription(remoteOffer);\n              const answer = await connection.createAnswer()\n              await connection.setLocalDescription(answer);\n              await roomRef.update({\n                [`${myId}.${candidateId}`]: {\n                  answer: {\n                    type: answer.type,\n                    sdp: answer.sdp\n                  }\n                }\n              });\n              console.log('step 2: set offer created answer and updated answer');\n            }\n            if (data && data[`iceGatheringComplete_for_${myId}`] && data[`iceGatheringComplete_for_${candidateId}`]) {\n              // this is use to initiate trying candidate pairs\n              await roomRef.update({\n                [`${myId}.${candidateId}.try_canditate`]: 0,\n                [`${myId}.${candidateId}.iceGatheringComplete_for_${myId}`]: false,\n                [`${myId}.${candidateId}.iceGatheringComplete_for_${candidateId}`]: false,\n              });        \n            }\n            if (data && data[`try_canditate`] >= 0 && !data['try_canditate_start'] && !window.connectedCandidates.includes(candidateId)) {\n              const candidateIndex = data[`try_canditate`];\n              const iceCandidate = data[`candidate_for_${myId}`][candidateIndex];  \n              if (iceCandidate) {\n                const candidate = new RTCIceCandidate(iceCandidate);\n                await RTCPeerConnections[candidateId].addIceCandidate(candidate);\n                // const result = await resolveWhenConnectionStateFailOrConnected(RTCPeerConnections[candidateId]);\n                console.log('tried ', candidateIndex, RTCPeerConnections[candidateId].connectionState);\n              }\n              await roomRef.update({\n                [`${myId}.${candidateId}.try_canditate_start`]: true\n              }); \n            }\n          }\n        }\n        // search answer, consume answer and setRemoteDescription\n        for (const candidateId of Object.keys(RTCPeerConnections)) {\n          const connection = RTCPeerConnections[candidateId];\n          const data = snapshot.data()[candidateId][myId];\n          if (!connection.currentRemoteDescription && data && data.answer) {\n            const answer = new RTCSessionDescription(data.answer);\n            await connection.setRemoteDescription(answer);\n            console.log('Step 3: Got the answer and set the answer to remote');\n          }\n          if ( data && data[`try_canditate_start`] && !window.connectedCandidates.includes(candidateId)) {\n            const candidateIndex = data[`try_canditate`];\n            const iceCandidates = data[`candidate_for_${myId}`] || [];\n            for (const iceCandidate of iceCandidates) {\n              if (!window.connectedCandidates.includes(candidateId) && iceCandidate) {\n                const candidate = new RTCIceCandidate(iceCandidate);\n                await connection.addIceCandidate(candidate);\n                console.log('tried ', candidateIndex);\n                const result = await resolveWhenConnectionStateFailOrConnected(connection);\n                console.log(result, connection.connectionState);\n              }\n            }\n            if (!window.connectedCandidates.includes(candidateId) && candidateIndex + 1 < data[`candidate_for_${candidateId}`].length) {\n              await roomRef.update({\n                [`${candidateId}.${myId}.try_canditate`]: candidateIndex + 1,\n                [`${candidateId}.${myId}.try_canditate_start`]: false\n              }); \n            }\n          }\n        }\n      }\n    });\n  }\n  function resolveWhenConnectionStateFailOrConnected(con) {\n    return new Promise(resolve => {\n      console.log(con.connectionState);\n      setInterval(() => {\n        if (con.connectionState ==='connected' || con.connectionState ==='failed') {\n          resolve(con.connectionState);\n        }\n      }, 500);\n    });\n  }\n  init();\n  return (\n    <div id=\"room\">\n      <video id=\"localVideo\" muted autoPlay playsInline style={{width: '100%', maxWidth: '500px'}}></video>\n    </div>\n  );\n}","import { Button } from 'react-bootstrap';\nimport './App.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport Room from './room/Room';\nimport db from './firebase.config';\n\nfunction App() {\n  const roomId = window.location.search.split('=')[1];\n  if (roomId) {\n    return <Room/>\n  }\n  const createRoom = async () => {\n    const roomRef = await db.collection('rooms').add({});\n    window.location.href = `${window.location.href}?roomId=${roomRef.id}`;\n  }\n  return (\n    <div className=\"App\">\n      <Button\n        variant=\"primary\"\n        onClick={createRoom}>\n        Create Room →\n      </Button>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}