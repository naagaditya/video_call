(this.webpackJsonpvideo_call=this.webpackJsonpvideo_call||[]).push([[0],{26:function(e,t,n){},28:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(7),c=n.n(a),r=n(20),o=n.n(r),i=(n(26),n(5)),s=n.n(i),u=n(10),d=n(37),p=(n(28),n(29),n(21)),f=n(9),l=n(14);l.a.initializeApp({apiKey:"AIzaSyDdzhAHhMQeAo4egpTbj3K-JiuV_InAFkU",authDomain:"fir-rtc-8e4b2.firebaseapp.com",databaseURL:"https://fir-rtc-8e4b2.firebaseio.com",projectId:"fir-rtc-8e4b2",storageBucket:"fir-rtc-8e4b2.appspot.com",messagingSenderId:"159303557727",appId:"1:159303557727:web:2ae59edac452b77736b1ea",measurementId:"G-FWJYK5VF1B"});var b=l.a.firestore(),h=function(e){var t=document.createElement("video");t.style="width: 100%;max-width:500px;",t.playsInline=!0,t.autoplay=!0,t.srcObject=e,document.getElementById("room").appendChild(t)},x={iceServers:[{urls:["stun:turn2.l.google.com"]}]},m=function(e){var t=new RTCPeerConnection(x);e&&e.getTracks().forEach((function(n){console.log("adding track in connection"),t.addTrack(n,e)}));var n=new MediaStream;return t.createDataChannel("sendChannel").onopen=function(e){console.log("open!!!!"),h(n)},t.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){n.addTrack(e)}))},t},v=n(11);function w(){var e;(function(){var t=Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:e=t.sent,document.querySelector("#localVideo").srcObject=e;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()();var t=window.location.search.split("=")[1],n=b.collection("rooms").doc("".concat(t)),a={},c=0,r=function(){var t=Object(u.a)(s.a.mark((function t(r){var o,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=m(e),a[r]=o,o.onicecandidate=function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.candidate){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(r,".").concat(c,".candidate_for_").concat(c),l.a.firestore.FieldValue.arrayUnion(t.candidate.toJSON())));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.onicegatheringstatechange=function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("complete"!==t.target.iceGatheringState||"connected"===o.connectionState){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(r,".").concat(c,".iceGatheringComplete_for_").concat(c),!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.onicecandidateerror=function(e){console.log(e.errorText)},t.next=7,o.createOffer();case 7:return i=t.sent,t.next=10,n.update(Object(f.a)({},"".concat(r,".").concat(c),{offer:{type:i.type,sdp:i.sdp}}));case 10:o.setLocalDescription(i),console.log("step 1: offer created and updated");case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return function(){var t=Object(u.a)(s.a.mark((function t(){var o,i,d;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.get();case 2:return o=t.sent,i=o.exists&&o.data(),(d=parseInt(Object.keys(i).length))&&(c=parseInt(Object.keys(i)[d-1])+1,Object.keys(o.data()).forEach(r)),t.next=8,n.update(Object(f.a)({},c,{}));case 8:n.onSnapshot(function(){var t=Object(u.a)(s.a.mark((function t(r){var o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=r.data()[c],Object.keys(o).forEach(function(){var t=Object(u.a)(s.a.mark((function t(r){var i,d,p,b,h,x,v,w,j;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a[r]||"connected"!==a[r].connectionState){t.next=2;break}return t.abrupt("return");case 2:if(!(i=o[r])||!i.offer||a[r]){t.next=20;break}return d=i.offer,p=m(e),a[r]=p,p.onicecandidate=function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.candidate){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(c,".").concat(r,".candidate_for_").concat(c),l.a.firestore.FieldValue.arrayUnion(t.candidate.toJSON())));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p.onicegatheringstatechange=function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("complete"!==t.target.iceGatheringState||"connected"===p.connectionState){e.next=3;break}return e.next=3,n.update(Object(f.a)({},"".concat(c,".").concat(r,".iceGatheringComplete_for_").concat(c),!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=new RTCSessionDescription(d),t.next=12,p.setRemoteDescription(b);case 12:return t.next=14,p.createAnswer();case 14:return h=t.sent,t.next=17,p.setLocalDescription(h);case 17:return t.next=19,n.update(Object(f.a)({},"".concat(c,".").concat(r),{answer:{type:h.type,sdp:h.sdp}}));case 19:console.log("step 2: set offer created answer and updated answer");case 20:if(!(i&&i["iceGatheringComplete_for_".concat(c)]&&i["iceGatheringComplete_for_".concat(r)])){t.next=23;break}return t.next=23,n.update((x={},Object(f.a)(x,"".concat(c,".").concat(r,".try_canditate"),0),Object(f.a)(x,"".concat(c,".").concat(r,".iceGatheringComplete_for_").concat(c),!1),Object(f.a)(x,"".concat(c,".").concat(r,".iceGatheringComplete_for_").concat(r),!1),x));case 23:if(!(i&&i.try_canditate>=0)||i.try_canditate_start){t.next=32;break}if(v=i.try_canditate,!(w=i["candidate_for_".concat(c)][v])){t.next=30;break}return j=new RTCIceCandidate(w),t.next=30,a[r].addIceCandidate(j);case 30:return t.next=32,n.update(Object(f.a)({},"".concat(c,".").concat(r,".try_canditate_start"),!0));case 32:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Object.keys(a).forEach(function(){var e=Object(u.a)(s.a.mark((function e(t){var o,i,u,d,l,b,h,x,m,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a[t],i=r.data()[t][c],o.currentRemoteDescription||!i||!i.answer){e.next=7;break}return u=new RTCSessionDescription(i.answer),e.next=6,o.setRemoteDescription(u);case 6:console.log("Step 3: Got the answer and set the answer to remote");case 7:if(!i||!i.try_canditate_start){e.next=35;break}d=i.try_canditate,l=i["candidate_for_".concat(t)]||[],b=Object(p.a)(l),e.prev=11,b.s();case 13:if((h=b.n()).done){e.next=24;break}if(x=h.value,"connected"!==o.connectionState){e.next=18;break}return console.log("connected"),e.abrupt("return",!0);case 18:if(!x){e.next=22;break}return m=new RTCIceCandidate(x),e.next=22,o.addIceCandidate(m);case 22:e.next=13;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(11),b.e(e.t0);case 29:return e.prev=29,b.f(),e.finish(29);case 32:if(!("connected"!==o.connectionState&&d<i["candidate_for_".concat(c)].length)){e.next=35;break}return e.next=35,n.update((v={},Object(f.a)(v,"".concat(t,".").concat(c,".try_canditate"),d+1),Object(f.a)(v,"".concat(t,".").concat(c,".try_canditate_start"),!1),v));case 35:case"end":return e.stop()}}),e,null,[[11,26,29,32]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),Object(v.jsx)("div",{id:"room",children:Object(v.jsx)("video",{id:"localVideo",muted:!0,autoPlay:!0,playsInline:!0,style:{width:"100%",maxWidth:"500px"}})})}var j=function(){if(window.location.search.split("=")[1])return Object(v.jsx)(w,{});var e=function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.collection("rooms").add({});case 2:t=e.sent,window.location.href="".concat(window.location.href,"?roomId=").concat(t.id);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(v.jsx)("div",{className:"App",children:Object(v.jsx)(d.a,{variant:"primary",onClick:e,children:"Create Room \u2192"})})};o.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(j,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.c4614527.chunk.js.map